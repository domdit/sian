<!DOCTYPE html>
<html lang="en">
    <head>
        <title>{{ title }}</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- my style sheet -->
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='main.css') }}">

        <!-- JQuery UI CSS -->
        <link href = "https://code.jquery.com/ui/1.10.4/themes/ui-lightness/jquery-ui.css" rel = "stylesheet">

        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
              integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css"
              integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

        <!-- jquery (I do not know if this is even necessary) -->
        <script src = "https://code.jquery.com/jquery-1.10.2.js"></script>
        <script src = "https://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

        <!-- Latest compiled and minified JavaScript -->
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
                integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>



        <!-- sortable script -->
        <script>
            $( document ).ready(function() {
                 console.log( "ready!" );
            });

            $(function() {
                $( "#sortable" ).sortable({
                    update: function(event, ui) {
                        var postData = $(this).sortable('serialize');



                    }
                });
            });
        </script>
        <script>
            function postSave() {

                var list = [];

                $('.kore').each(function (index) {
                    list.push(this.id);
                });

                console.log(list)

                fetch(`${window.origin}/post`, {
                    method: 'POST',
                    credentials: "include",
                    body: JSON.stringify(list),
                    cache: "no-cache",
                    headers: new Headers({
                        "content-type": "application/json"
                    })
                })
                .then(function(response) {

                    if (response.status !== 200) {
                        console.log(`RESPONSE STATUS WAS NOT 200: ${response.status}`);
                        return;
                    }

                    response.json().then( function (list) {
                    console.log(list)
                    });
                })
                .catch(function(error) {
                    console.log("Fetch error: " + error);

                });





            };

        </script>



    </head>
    <body>
        <div class="container">
            <h1>Sian Street Food - Admin Page</h1>

            <!-- FORM -->
            <div class="container">
                <form action="" method="POST">
                    {{ form.hidden_tag() }}
                    <fieldset class="form-group">
                        <legend class="border-bottom mb-4">Add New Item</legend>
                            <div class="form-group">
                                {{ form.name.label(class="form-control-label") }}
                                {{ form.name(class="form-control form-control-lg") }}
                            </div>
                            <div class="form-group">
                                {{ form.description.label(class="form-control-label") }}
                                {{ form.description(class="form-control form-control-lg") }}
                            </div>
                            <div class="form-check float-left">
                                {{ form.head(class="form-check-input") }}
                                {{ form.head.label(class="form-check-label") }}
                            </div>
                            <div class="form-check">
                                {{ form.spice(class="form-check-input") }}
                                {{ form.spice.label(class="form-check-label") }}
                            </div>
                            <div class="form-check">
                                {{ form.veg(class="form-check-input") }}
                                {{ form.veg.label(class="form-check-label") }}
                            </div>

                    </fieldset>
                    <div class="form_group">
                        {{ form.submit(class="btn btn-outline-info") }}
                    </div>
                </form>
            </div>

            <!-- MENU ITEMS -->

            <div class="container menu">
                <ul id="sortable">
                    {% for item in items %}
                    <li class="nobull kore" id="{{ item.id }}">
                        <div class="menu_item">
                            {% if item.head == True %}

                                <div class="menu_heading">
                                    {{ item.name }}

                                </div>

                            {% else %}

                                <div class="menu_item_name">
                                    {{ item.name }}
                                </div>
                                <div class="menu_item_description">
                                    {{ item.description }}
                                </div>

                            {% endif %}

                            <a href="{{ url_for('delete_item', item_id=item.id) }}">Delete</a>

                        </div>
                    </li>
                    {% endfor %}
                </ul>
                <button onclick="postSave()">DO IT!</button><br>
            </div>


        </div>


    </body>
</html>